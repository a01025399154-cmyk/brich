name: 크롤링 실행

on:
  workflow_dispatch:  # 수동 실행 버튼
  # schedule:
  #   - cron: '0 0 * * *'  # 필요시 자동 스케줄 (매일 자정 UTC)

jobs:
  crawl:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v3
    
    - name: Python 설정
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Chrome 설치
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip
        wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo apt-get install -y ./google-chrome-stable_current_amd64.deb
    
    - name: 의존성 설치
      run: |
        pip install --upgrade pip
        pip install -r crawler/requirements.txt
    
    - name: Service Account 파일 생성
      run: |
        echo '${{ secrets.GOOGLE_SA_JSON }}' > crawler/service_account.json
    
    - name: 크롤링 실행
      run: python crawler/local_crawler.py
    
    - name: 임시 파일 정리
      if: always()
      run: rm -f crawler/service_account.json